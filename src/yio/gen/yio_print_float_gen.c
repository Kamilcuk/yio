/**
 * @file yio_print_float_gen.c
 * @date 5 kwi 2020
 * @author Kamil Cukrowski
 * @copyright GPL-3.0-only
 * SPDX-License-Identifier: GPL-3.0-only
 */
/**
 * DO NOT EDIT THIS FILE!!!
 * This file was autogenerated by m4 from /home/users/kamil/Documents/ystdio/src/yio/gen/yio_print_float_gen.c.m4
 * On Mon Apr  6 23:11:10 UTC 2020
 * Edit the m4 source file to edit this file.
 */
#if 0
#include "yio_print_float_gen.c.m4"
#endif
#define __STDC_WANT_IEC_60559_BFP_EXT__ 1
#define __STDC_WANT_IEC_60559_TYPES_EXT__ 1
#define __STDC_WANT_DEC_FP__  1
#include <yio/yio_private.h>
#include <float.h>
#include <assert.h>
#include <errno.h>
#include <string.h>

static inline
const char *_yIO_printfmt_to_cfmt_for_floats_in(
		char *dest, size_t destsize,
		struct yio_printfmt_s *f,
		int default_precision) {
	const char type = f->type ? f->type : 'g';
	assert(strchr("aAeEfFgG", type) != NULL);
	const int precision = f->precision < 0 ? default_precision : f->precision;
	const int len = snprintf(dest, destsize, "%%.%d%c", precision, type);
	(void)len;
	assert(len < (int)destsize);
	return dest;
}

#define _yIO_printfmt_to_cfmt_for_floats_buflen \
		(INT_STRLEN_BOUND(int) + sizeof("%.f"))

#define _yIO_printfmt_to_cfmt_for_floats(fmt, default_width) \
		_yIO_printfmt_to_cfmt_for_floats_in( \
				(char[_yIO_printfmt_to_cfmt_for_floats_buflen]){0}, \
				_yIO_printfmt_to_cfmt_for_floats_buflen, \
				fmt, \
				default_width)

#define m4__yIO_print_generic(FUNCTION_NAME, type, MAX_RESOLUTION, strfrom, ...)


#ifdef FLT_DECIMAL_DIG
static inline
int _yIO_print_float_in(yio_printctx_t *t, float f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT_DECIMAL_DIG);
	const int len = strfromf(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
#endif

#ifdef DBL_DECIMAL_DIG

#ifdef FLT_DECIMAL_DIG
static inline
int _yIO_print_double_that_is_float_in(yio_printctx_t *t, double f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT_DECIMAL_DIG);
	const int len = strfromf(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
#endif

#endif

#ifdef DBL_DECIMAL_DIG
static inline
int _yIO_print_double_in(yio_printctx_t *t, double f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DBL_DECIMAL_DIG);
	const int len = strfromd(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print_double(yio_printctx_t *t) {
	const double f = yio_printctx_va_arg_num(t, double);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef LDBL_DECIMAL_DIG
static inline
int _yIO_print_ldouble_in(yio_printctx_t *t, long double f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), LDBL_DECIMAL_DIG);
	const int len = strfroml(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfroml(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print_ldouble(yio_printctx_t *t) {
	const long double f = yio_printctx_va_arg_num(t, long double);
	return _yIO_print_double_in(t, f);
}
#endif

#if _yIO_USE__FLOATN

#ifdef FLT16_DECIMAL_DIG
static inline
int _yIO_print__Float16_in(yio_printctx_t *t, _Float16 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT16_DECIMAL_DIG);
	const int len = strfromf16(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf16(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float16(yio_printctx_t *t) {
	const _Float16 f = yio_printctx_va_arg_num(t, _Float16);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef FLT32_DECIMAL_DIG
static inline
int _yIO_print__Float32_in(yio_printctx_t *t, _Float32 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT32_DECIMAL_DIG);
	const int len = strfromf32(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf32(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float32(yio_printctx_t *t) {
	const _Float32 f = yio_printctx_va_arg_num(t, _Float32);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef FLT64_DECIMAL_DIG
static inline
int _yIO_print__Float64_in(yio_printctx_t *t, _Float64 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT64_DECIMAL_DIG);
	const int len = strfromf64(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf64(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float64(yio_printctx_t *t) {
	const _Float64 f = yio_printctx_va_arg_num(t, _Float64);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef FLT128_DECIMAL_DIG
static inline
int _yIO_print__Float128_in(yio_printctx_t *t, _Float128 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT128_DECIMAL_DIG);
	const int len = strfromf128(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf128(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float128(yio_printctx_t *t) {
	const _Float128 f = yio_printctx_va_arg_num(t, _Float128);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef FLT32X_DECIMAL_DIG
static inline
int _yIO_print__Float32x_in(yio_printctx_t *t, _Float32x f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT32X_DECIMAL_DIG);
	const int len = strfromf32x(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf32x(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float32x(yio_printctx_t *t) {
	const _Float32x f = yio_printctx_va_arg_num(t, _Float32x);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef FLT64X_DECIMAL_DIG
static inline
int _yIO_print__Float64x_in(yio_printctx_t *t, _Float64x f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT64X_DECIMAL_DIG);
	const int len = strfromf64x(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf64x(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float64x(yio_printctx_t *t) {
	const _Float64x f = yio_printctx_va_arg_num(t, _Float64x);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef FLT128X_DECIMAL_DIG
static inline
int _yIO_print__Float128x_in(yio_printctx_t *t, _Float128x f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), FLT128X_DECIMAL_DIG);
	const int len = strfromf128x(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromf128x(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Float128x(yio_printctx_t *t) {
	const _Float128x f = yio_printctx_va_arg_num(t, _Float128x);
	return _yIO_print_double_in(t, f);
}
#endif

#endif
#if _yIO_USE__DECIMALN

#ifdef DEC32_DECIMAL_DIG
static inline
int _yIO_print__Decimal32_in(yio_printctx_t *t, _Decimal32 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DEC32_DECIMAL_DIG);
	const int len = strfromd32(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd32(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Decimal32(yio_printctx_t *t) {
	const _Decimal32 f = yio_printctx_va_arg_num(t, _Decimal32);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef DEC64_DECIMAL_DIG
static inline
int _yIO_print__Decimal64_in(yio_printctx_t *t, _Decimal64 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DEC64_DECIMAL_DIG);
	const int len = strfromd64(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd64(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Decimal64(yio_printctx_t *t) {
	const _Decimal64 f = yio_printctx_va_arg_num(t, _Decimal64);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef DEC128_DECIMAL_DIG
static inline
int _yIO_print__Decimal128_in(yio_printctx_t *t, _Decimal128 f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DEC128_DECIMAL_DIG);
	const int len = strfromd128(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd128(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Decimal128(yio_printctx_t *t) {
	const _Decimal128 f = yio_printctx_va_arg_num(t, _Decimal128);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef DEC32_DECIMAL_DIG
static inline
int _yIO_print__Decimal32x_in(yio_printctx_t *t, _Decimal32x f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DEC32_DECIMAL_DIG);
	const int len = strfromd32x(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd32x(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Decimal32x(yio_printctx_t *t) {
	const _Decimal32x f = yio_printctx_va_arg_num(t, _Decimal32x);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef DEC64_DECIMAL_DIG
static inline
int _yIO_print__Decimal64x_in(yio_printctx_t *t, _Decimal64x f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DEC64_DECIMAL_DIG);
	const int len = strfromd64x(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd64x(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Decimal64x(yio_printctx_t *t) {
	const _Decimal64x f = yio_printctx_va_arg_num(t, _Decimal64x);
	return _yIO_print_double_in(t, f);
}
#endif


#ifdef DEC128_DECIMAL_DIG
static inline
int _yIO_print__Decimal128x_in(yio_printctx_t *t, _Decimal128x f) {
	const char *cformat = _yIO_printfmt_to_cfmt_for_floats(yio_printctx_get_fmt(t), DEC128_DECIMAL_DIG);
	const int len = strfromd128x(NULL, 0, cformat, f);
	assert(len >= 0);
	char * const str = malloc((len + 1) * sizeof(str));
	if (str == NULL) {
		return YIO_ERROR_ENOMEM;
	}
	const int len2 = strfromd128x(str, len + 1, cformat, f);
	(void)len2;
	assert(len2 == len);
	const bool is_negative = str[0] == '-';
	const int format_err = _yIO_print_format_number(t, str + is_negative, !is_negative);
	free(str);
	return format_err;
}
int _yIO_print__Decimal128x(yio_printctx_t *t) {
	const _Decimal128x f = yio_printctx_va_arg_num(t, _Decimal128x);
	return _yIO_print_double_in(t, f);
}
#endif

#endif

int _yIO_print_floatptr(yio_printctx_t *t) {
	const float *fptr = yio_printctx_va_arg(t, float*);
	assert(fptr != NULL);
	const float f = *fptr;
	return _yIO_print_float_in(t, f);
}

int _yIO_print_float(yio_printctx_t *t) {
	const double f = yio_printctx_va_arg_num(t, float);
	return _yIO_print_double_that_is_float_in(t, f);
}
